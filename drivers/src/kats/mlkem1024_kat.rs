/*++

Licensed under the Apache-2.0 license.

File Name:

    mlkem1024_kat.rs

Abstract:

    File contains the Known Answer Tests (KAT) for MLKEM1024 cryptography operations.

--*/

use crate::{
    cprintln, CaliptraError, CaliptraResult, LEArray4x392, LEArray4x792, LEArray4x8, MlKem1024,
    MlKem1024MessageSource, MlKem1024Seeds, MlKem1024SharedKey, MlKem1024SharedKeyOut,
};

// Taken from NIST test vectors: https://github.com/usnistgov/ACVP-Server/blob/master/gen-val/json-files/ML-KEM-keyGen-FIPS203/internalProjection.json

const KEYGEN_SEED_Z: LEArray4x8 = LEArray4x8::new([
    0x6C4D060A, 0x73ABCE06, 0xA9FC9CE5, 0x250264FF, 0xEF6A325A, 0x78B69C1E, 0x9D9236BF, 0x589AE2AF,
]);

const KEYGEN_SEED_D: LEArray4x8 = LEArray4x8::new([
    0xC430532B, 0xFDFD3BF2, 0x50F0315C, 0x23383BBA, 0x03BF2453, 0x12FC7223, 0x89D04DD0, 0x59BDF020,
]);

// TODO: we could store just the hash of the EK and DKs, and combine with the encaps/decaps test's
// keys if we use a non-NIST source to generate the expected K and M.
// We will have to keep the whole ciphertext though.

const KEYGEN_EK: LEArray4x392 = LEArray4x392::new([
    0xA57441B2, 0x52BF0DB0, 0x78E3B90C, 0x032E483D, 0xD46631CA, 0x7B2A080D, 0x454866AB, 0xD9AD17B6,
    0xA3C6078C, 0x814F20C3, 0x3A683520, 0xAC104F1D, 0x7064E71D, 0xD796CE6C, 0x62A43258, 0x2CB8B1A8,
    0xF8CB71F4, 0x0865A208, 0x43A5FAD9, 0x0398CDF2, 0x94F7D677, 0x06387936, 0x88D36D4B, 0x697529C5,
    0xA52CB163, 0xAB06B394, 0xB6BB0E3F, 0x1A6047ED, 0xA27410EC, 0x17B4D1B0, 0x95C6F817, 0x73EF74F1,
    0x7E075240, 0x479FDC53, 0x08666B31, 0x4EB5EDB7, 0x361A63A3, 0x2C848DBB, 0x7C3627AF, 0xDB8DC115,
    0x2AE6AFA7, 0x331372A5, 0x2587CB84, 0x168A9455, 0x2C4C205F, 0x9D3C50B4, 0x525FCE8A, 0x674A1917,
    0x2FA7D2EB, 0x982F5699, 0xB673B7B2, 0x1B075C96, 0xD3EE1DF1, 0x3E15BC95, 0x927496D6, 0xF35E8DD8,
    0x08E0052D, 0x2F8A95B7, 0x06DBB936, 0xA652DCCC, 0x66794126, 0x79509CB1, 0xA42B89A9, 0x2F36A026,
    0xC07E8EB1, 0xC5C0FD7F, 0xDE64E2DB, 0x83BC41EC, 0x9A5973A5, 0x9B90A825, 0x23687624, 0xA3C9CE36,
    0x001A2096, 0xE71B9C0A, 0x8F98D992, 0x48C203BC, 0x42B2C155, 0x27A127AE, 0x5C4136CD, 0xCC980DFB,
    0x3AD89BBB, 0x748D98F5, 0xEAAC7337, 0x93AC0142, 0x46CC7C5E, 0x848E2DE9, 0xC60CD7A9, 0x29549626,
    0xE0800945, 0x1CE12E78, 0xCE6911D9, 0xC189BF94, 0x900BC14E, 0x71B7B40E, 0x0359A829, 0x3E25D19A,
    0x61B25756, 0xC45B85E9, 0xC404F5B0, 0x4A8FD578, 0xA0158238, 0x10685171, 0xDAC22695, 0x7C0055C5,
    0x790BE166, 0x1A4792EB, 0x08649ACC, 0x7E94BD05, 0x6AB645EA, 0xB7D5022C, 0x459902C9, 0x6D6681B5,
    0x65D20C47, 0x331CB54E, 0xCB52AC04, 0x862B3811, 0x633B5528, 0xB2412C74, 0x757B4693, 0x2AF5F84D,
    0xF25E9A7B, 0x40F39B35, 0x8D31A925, 0x71142BF9, 0x899E52EC, 0x9C991458, 0xEC561355, 0x5694CAC9,
    0x167B0641, 0x16B404AC, 0xA3F8C29C, 0x0405A0B9, 0x4DAAC17A, 0x84F27FF2, 0xA819ABC7, 0x5A9B6200,
    0x3468B085, 0x18C03A62, 0x1CCAE4D2, 0xB4D797A1, 0xBE85C158, 0x70B4A90B, 0x62F81138, 0x90B6138D,
    0xBD442560, 0x21AEAF69, 0x51DB5B5F, 0x70B55C31, 0x558B8DD4, 0x56500D12, 0x4C59590E, 0xFB03568B,
    0x4E487ECC, 0x701059AF, 0xD4AD5F86, 0x7BD6C495, 0x1CCF67FC, 0x50CD4AB9, 0x220A97C8, 0xFFC00B6C,
    0xC5BD86A1, 0xAC35D21D, 0x345F088D, 0x8CC87483, 0x47E10662, 0x30043123, 0x06E31669, 0x1BABF035,
    0xE0446695, 0xBCE24E2A, 0x886024C3, 0xA670D5D3, 0x5031A617, 0x0DD52BB3, 0xD65D55AA, 0x346D8BBB,
    0x3AA8CBC0, 0x483BC241, 0xD70897B3, 0xC5338D57, 0x84A20AA6, 0xBA10CB30, 0x8A154D26, 0xA001F3BF,
    0x95BD3207, 0x43909153, 0x892FD06A, 0x21E95C31, 0x30049C49, 0xB7CF815D, 0x4BBA7A99, 0x9A63652D,
    0x671B9034, 0x239A2C97, 0x0EA1B555, 0xE055F991, 0x3AF35FA9, 0x8B4AFA21, 0xA68E018E, 0x46343FE4,
    0xA295AF2D, 0x9C71CC9D, 0xE5EA7E2B, 0x70495003, 0x53ACF606, 0xF9CB8FD2, 0x2AB04508, 0x8DC54688,
    0xC6C09464, 0x76342803, 0x671712AF, 0x830C60A9, 0x8D2BE9A9, 0x68C2197B, 0x0448190B, 0x9E7C804B,
    0xBE94ECA7, 0xEA3ACF30, 0x15166D67, 0x97BCA39F, 0x0AED55C0, 0xC2F59A43, 0x06BC85F0, 0xD6DEA580,
    0xC3430882, 0x3851F6D3, 0x8CE4ACE5, 0x03110C7A, 0x48676171, 0xD94F0826, 0x221331BA, 0x4A56183F,
    0x84D98D9B, 0x7A83D172, 0xE2665BB8, 0x4A8A63C2, 0xC3D69D8D, 0x866BBA61, 0x9BED9F62, 0x75DC766E,
    0x8B9058B2, 0xE8170175, 0x1C3A76A4, 0x5EBE0B0C, 0xD5C51626, 0x0372605B, 0x636DF071, 0xFA613089,
    0xA6763C6B, 0x529B1700, 0xF419C3F0, 0x9A18107A, 0x726A560F, 0xD90CC492, 0x12010C98, 0x0C6665F2,
    0x73604F3B, 0x4593966A, 0x1F867B4A, 0xB8354D83, 0x47A6F838, 0xBC301677, 0xF6231FBC, 0xB67C88AA,
    0xCC82D5CB, 0xBACD4022, 0x50674186, 0x34C4436A, 0x75AD7EC2, 0x32D28444, 0x0CC43BA8, 0x68301822,
    0x200A0316, 0x70545A76, 0x2C5B7E21, 0x44638490, 0xC4C28BCD, 0xE870B798, 0x9D95D13C, 0xCBBC52C1,
    0x36ABCE4A, 0x61F3F7AB, 0xF547128C, 0x101320DB, 0x74E5A1C0, 0x397C54FA, 0x4AA4C58C, 0xB68536C2,
    0xF6B8074D, 0xC4164061, 0xC6711B27, 0x20B5A850, 0x8BA0AFA5, 0x16E54EA0, 0xFBA7B846, 0xF53A2D65,
    0x5510407A, 0xAC6F858F, 0x091E91C9, 0x87C532B3, 0xE861DB0E, 0x19BB50E8, 0x5557AE49, 0xCCA2FBC1,
    0x02732047, 0x2B54D69F, 0x791BA7CD, 0x11F8BC52, 0x882A8F60, 0xF2041A29, 0x11B14B66, 0x23B1272E,
    0x92C1165B, 0x794E2103, 0x8C315A14, 0x2D151051, 0x1AB26BA3, 0x118073CA, 0xB1B8D685, 0xB344A3F6,
    0x0F553E3B, 0xBC29DCB5, 0xE84698D1, 0xC8BB7440, 0xD30C58F7, 0x122FB547, 0x6C61D1A7, 0x1FCDA255,
    0x67A84A5C, 0x0F53DD02, 0x13645AA0, 0x2761A102, 0x52858E46, 0x7075562E, 0xF8C35FB6, 0x205AD834,
    0xB20E3A97, 0x81D510B2, 0x88FBFD2C, 0x06AAC31C, 0x7BB74CAB, 0x6BDC7CBA, 0x023CE5CE, 0xB943330B,
    0x98829ABD, 0xEE5520AD, 0x8470601A, 0x62A84091, 0x15187288, 0x773497C7, 0xCF97403F, 0x96CC4147,
    0x810CA335, 0x3307B200, 0x350B98D3, 0xACFA9303, 0x6EE6D04C, 0x81C63747, 0xD7C8BCDB, 0x74A73F95,
    0xAD22C454, 0x8B270E87, 0x3CC32111, 0x0E377382, 0x6A6A685B, 0xA3FC17AB, 0x40307AB6, 0x411249D6,
    0x72305EBF, 0x421EDCFB, 0x5BFA1324, 0x1EE99E4E, 0xE236C9B3, 0x56785C1A, 0xA5442F94, 0x88A67056,
    0xA9919EA6, 0x09F40BA8, 0xF71D304C, 0xAC4D3305, 0x9492CDB0, 0x349F8273, 0xD24779F3, 0x62C0552B,
    0x03F7CCF4, 0xC01C3CEE, 0xDD1673BA, 0x6E6B8E65, 0xFCF81508, 0xBBB1709A, 0x32EC25A3, 0x160993E2,
]);
const KEYGEN_DK: LEArray4x792 = LEArray4x792::new([
    0x127C51F7, 0x191EA658, 0x115BF136, 0xA733BBDB, 0xCC3C73F7, 0x3C49D9B2, 0x5C9429BF, 0x19251E75,
    0x89A37A34, 0x2FCC4145, 0x90D51010, 0x54727844, 0xFDC23872, 0xBA6457EA, 0x3080090D, 0xC60E2A96,
    0x076B81BB, 0x2EECF47F, 0xABB4E6F1, 0xC91DB245, 0xB433A49E, 0x36CBF4B8, 0x97141DA4, 0x43DC6BA0,
    0x0FAA79CB, 0x86629E73, 0xB963A0AF, 0xE88F1308, 0x480E3337, 0x7E097AA4, 0xAC3ADCFA, 0xB359A0BA,
    0x1DB8B220, 0x279C5AAD, 0xD7664AB2, 0x48AB3A4B, 0xAA55E3E6, 0xDA7480F1, 0x41E29B3E, 0x3843C18C,
    0x64DF5381, 0x6A037295, 0x6C09A2BC, 0x039E8385, 0xA6FC344D, 0x070B53B9, 0x473405E8, 0xB7B63B9A,
    0xFB2299B0, 0x0BA25840, 0x4CA78525, 0xFE4FC145, 0xD4F86B07, 0x22C9F50C, 0x343D4AE1, 0x09595B32,
    0x0B879C72, 0x79C1BC36, 0x510E5964, 0xB166DECC, 0xAFCF5A42, 0xD1EC5CBC, 0x0068B10F, 0x56C6045C,
    0x4157B754, 0x238CF150, 0x3681F162, 0x20F19CA0, 0x1E37BA29, 0xB4298000, 0x1A0231B6, 0x6E752E25,
    0x410EC43B, 0x2A3A0A03, 0x915A2052, 0xA6B0F47E, 0xA879826A, 0xA20973B6, 0x086054D3, 0xF218BE5B,
    0x4072BB21, 0x894A009F, 0x2AAEA14B, 0x89131431, 0xB33D96FB, 0x0ADAC0F0, 0x09A39F17, 0x812DDA26,
    0xF0FFA67A, 0x7156F62B, 0x727FA86A, 0x7447B773, 0xACB3BA1C, 0x392D11FC, 0xDC93C142, 0x2A1AA332,
    0x42852504, 0x0718B506, 0x3DD960C9, 0x5F1A366E, 0x5AF1A629, 0x1DD07F41, 0xC364E225, 0x6369C822,
    0x9753FF69, 0x6D2DC5ED, 0xD6BA8B38, 0xBA296720, 0x5D85D714, 0xE94A42F4, 0x1AD18AC4, 0xF8A2AA19,
    0xBB50BEFB, 0x8320C16A, 0x740CE885, 0xB56A910C, 0x58475040, 0x0D9B87F7, 0xC0365B0B, 0x4E563E05,
    0x567E0115, 0x01EF6639, 0x0A6B9662, 0x400A336A, 0x1AD0C979, 0x9338B489, 0x64408CE3, 0xF9B147A2,
    0xABEA2786, 0x3A60A180, 0xFC1FC043, 0xA4DC635D, 0x1350EADA, 0xF7AFCA79, 0x230CBF7B, 0x1813098B,
    0xF4688154, 0xA2833B03, 0x6A02C6D2, 0xA43B97D2, 0x4B91013C, 0x8824DC27, 0xD962C705, 0x27B4E780,
    0x2D222B25, 0xBA9896E5, 0x6E9302AD, 0x4C703511, 0x1C530FF8, 0x2898FB13, 0x629719D1, 0x76694B79,
    0x3431FA2B, 0xD40AA2BC, 0x0BCE99F7, 0x6658275F, 0x5981D954, 0x91E17281, 0x4556B5B4, 0xCDC1277B,
    0x9A2A7BE1, 0x64465247, 0x22366939, 0x60F28DC6, 0x864BA88C, 0xCC3C55BC, 0x849C9DAB, 0x76B88723,
    0x1769944C, 0xDA0964E2, 0x2212921C, 0x2461AB73, 0x148B4D78, 0x347A2875, 0x0DA9E292, 0x11DD0B77,
    0x04FCF06B, 0x076AC560, 0x86B66DD8, 0x2D053A98, 0x2C39017E, 0xDBF8345B, 0x8039D341, 0xEF9A2A8D,
    0xA645C844, 0xAB8876B6, 0x1812FB74, 0x179DAFE7, 0xBE06E42D, 0x40CB320A, 0x30C30F71, 0x212AB898,
    0x249171AA, 0xA2123DEA, 0x3A04878E, 0xCD569BFE, 0xBB3485C5, 0x5197E438, 0xCC39B92C, 0xD3D7B43C,
    0x9F2CFBAD, 0x0011B14D, 0xBB776AD7, 0x08D3FA2C, 0xD01A17F3, 0x00118447, 0x64E9119B, 0x121A72D1,
    0x280AA925, 0x5B447350, 0x729F389E, 0xF0AC6AB4, 0x33DBC58E, 0xD438E0F7, 0xF08F4CCB, 0xBBD8A523,
    0xED3B54FD, 0x89D32E67, 0x287B8027, 0x35360C5B, 0x4755BFA1, 0x5559EA29, 0x71A1C195, 0x1C822281,
    0xBA726E44, 0xF3955C7C, 0xB265B3CA, 0x83A2E47C, 0x6F3845C7, 0xF5200326, 0x70A91568, 0x18274C4F,
    0x75609FD8, 0x3454D64B, 0x666350A6, 0x3330725B, 0x13228EAD, 0xC92E56B1, 0x0B376A29, 0x97548D0C,
    0xBF181769, 0xE2651FFA, 0xB709376B, 0x5B9432A6, 0xA9BE2F59, 0xBEB08805, 0x307687F3, 0x76FE2D21,
    0xA0402B79, 0x1673E1B4, 0x1141A61A, 0x9078AF9F, 0x593E7C5A, 0x0B6A68E3, 0x8AE45416, 0x182DC2B9,
    0xD556A4BC, 0x43B3DA53, 0xAB77E66E, 0xE7ECB97A, 0x907A6B41, 0x42871A92, 0x429726A9, 0x25F26B61,
    0xFAC8A272, 0xD1CCAFBB, 0xC9871E44, 0x3A5964AB, 0x955C0AE5, 0x084A8364, 0xAF621485, 0xB53D1AA4,
    0x3598D486, 0xCFA5B8CB, 0x5AB85059, 0x641A5DBE, 0x2921C8F8, 0x008048AC, 0x86534E47, 0xDE9A42B3,
    0x58458352, 0x0185812A, 0x0D9DC30D, 0x293D87A6, 0x5439BFBE, 0xAC0269A5, 0x57D93E62, 0x4A160371,
    0xBE899B83, 0x39A68C15, 0x3948EFC1, 0xABA1A302, 0xEBCC1315, 0x58F1DE62, 0x938507D0, 0xA0FF1E32,
    0x7CA1B057, 0xA7564985, 0x5CD5483C, 0xC411153B, 0xC91633B4, 0x78FB185C, 0x4DDC5244, 0x304D902C,
    0xB4176F20, 0x53754A64, 0x032A4644, 0xF0553D4C, 0x4328E44D, 0xE248D2CA, 0x6A61C256, 0x2410D698,
    0x7C54D9B1, 0x2576B386, 0x73334C48, 0xB186B7E0, 0xC17E0C22, 0x1557E7A3, 0x4A017C27, 0x7AFC1FC8,
    0x905B1380, 0xFB5DD6A9, 0x5030B0DC, 0x26DC6A75, 0x44169B94, 0xF1EFA4BB, 0x67CBBE33, 0xC496A9FB,
    0x9CC48D95, 0x82B82458, 0xCBAE3344, 0xFBDB68E4, 0x9F28463D, 0x8252B665, 0xA831BE04, 0x8E822BA2,
    0xCE6607A3, 0x0A386E08, 0x11EC946A, 0x00C93A9C, 0xE48B2B5D, 0x2EFAF07A, 0x068B007C, 0x2798CAC7,
    0x47A2E6B7, 0x951757A7, 0xD9E42647, 0x7E2BC86E, 0x9C9F46BD, 0xC2126664, 0x3EEC85A7, 0xD55CCBF1,
    0x007D6FA7, 0x9FB11864, 0x4A25C8B3, 0x98201338, 0x22F6034D, 0x552AC744, 0x0AF619AA, 0x900BEE63,
    0x8762A50B, 0x481D5D23, 0xC92A750E, 0x3C7DA505, 0x21C3B799, 0x503C100E, 0x433EC5FE, 0x10CC2609,
    0xCE40028F, 0x16513A4E, 0xE75B5B64, 0x0DAC039F, 0xFD008B37, 0x5C6C20A6, 0x1855BC5C, 0x8E3E2451,
    0x287B7CAC, 0x2F5913AA, 0xD66580F3, 0x663AB7F8, 0x15A42A81, 0x241644CE, 0x88820076, 0x021AAFAF,
    0xA57441B2, 0x52BF0DB0, 0x78E3B90C, 0x032E483D, 0xD46631CA, 0x7B2A080D, 0x454866AB, 0xD9AD17B6,
    0xA3C6078C, 0x814F20C3, 0x3A683520, 0xAC104F1D, 0x7064E71D, 0xD796CE6C, 0x62A43258, 0x2CB8B1A8,
    0xF8CB71F4, 0x0865A208, 0x43A5FAD9, 0x0398CDF2, 0x94F7D677, 0x06387936, 0x88D36D4B, 0x697529C5,
    0xA52CB163, 0xAB06B394, 0xB6BB0E3F, 0x1A6047ED, 0xA27410EC, 0x17B4D1B0, 0x95C6F817, 0x73EF74F1,
    0x7E075240, 0x479FDC53, 0x08666B31, 0x4EB5EDB7, 0x361A63A3, 0x2C848DBB, 0x7C3627AF, 0xDB8DC115,
    0x2AE6AFA7, 0x331372A5, 0x2587CB84, 0x168A9455, 0x2C4C205F, 0x9D3C50B4, 0x525FCE8A, 0x674A1917,
    0x2FA7D2EB, 0x982F5699, 0xB673B7B2, 0x1B075C96, 0xD3EE1DF1, 0x3E15BC95, 0x927496D6, 0xF35E8DD8,
    0x08E0052D, 0x2F8A95B7, 0x06DBB936, 0xA652DCCC, 0x66794126, 0x79509CB1, 0xA42B89A9, 0x2F36A026,
    0xC07E8EB1, 0xC5C0FD7F, 0xDE64E2DB, 0x83BC41EC, 0x9A5973A5, 0x9B90A825, 0x23687624, 0xA3C9CE36,
    0x001A2096, 0xE71B9C0A, 0x8F98D992, 0x48C203BC, 0x42B2C155, 0x27A127AE, 0x5C4136CD, 0xCC980DFB,
    0x3AD89BBB, 0x748D98F5, 0xEAAC7337, 0x93AC0142, 0x46CC7C5E, 0x848E2DE9, 0xC60CD7A9, 0x29549626,
    0xE0800945, 0x1CE12E78, 0xCE6911D9, 0xC189BF94, 0x900BC14E, 0x71B7B40E, 0x0359A829, 0x3E25D19A,
    0x61B25756, 0xC45B85E9, 0xC404F5B0, 0x4A8FD578, 0xA0158238, 0x10685171, 0xDAC22695, 0x7C0055C5,
    0x790BE166, 0x1A4792EB, 0x08649ACC, 0x7E94BD05, 0x6AB645EA, 0xB7D5022C, 0x459902C9, 0x6D6681B5,
    0x65D20C47, 0x331CB54E, 0xCB52AC04, 0x862B3811, 0x633B5528, 0xB2412C74, 0x757B4693, 0x2AF5F84D,
    0xF25E9A7B, 0x40F39B35, 0x8D31A925, 0x71142BF9, 0x899E52EC, 0x9C991458, 0xEC561355, 0x5694CAC9,
    0x167B0641, 0x16B404AC, 0xA3F8C29C, 0x0405A0B9, 0x4DAAC17A, 0x84F27FF2, 0xA819ABC7, 0x5A9B6200,
    0x3468B085, 0x18C03A62, 0x1CCAE4D2, 0xB4D797A1, 0xBE85C158, 0x70B4A90B, 0x62F81138, 0x90B6138D,
    0xBD442560, 0x21AEAF69, 0x51DB5B5F, 0x70B55C31, 0x558B8DD4, 0x56500D12, 0x4C59590E, 0xFB03568B,
    0x4E487ECC, 0x701059AF, 0xD4AD5F86, 0x7BD6C495, 0x1CCF67FC, 0x50CD4AB9, 0x220A97C8, 0xFFC00B6C,
    0xC5BD86A1, 0xAC35D21D, 0x345F088D, 0x8CC87483, 0x47E10662, 0x30043123, 0x06E31669, 0x1BABF035,
    0xE0446695, 0xBCE24E2A, 0x886024C3, 0xA670D5D3, 0x5031A617, 0x0DD52BB3, 0xD65D55AA, 0x346D8BBB,
    0x3AA8CBC0, 0x483BC241, 0xD70897B3, 0xC5338D57, 0x84A20AA6, 0xBA10CB30, 0x8A154D26, 0xA001F3BF,
    0x95BD3207, 0x43909153, 0x892FD06A, 0x21E95C31, 0x30049C49, 0xB7CF815D, 0x4BBA7A99, 0x9A63652D,
    0x671B9034, 0x239A2C97, 0x0EA1B555, 0xE055F991, 0x3AF35FA9, 0x8B4AFA21, 0xA68E018E, 0x46343FE4,
    0xA295AF2D, 0x9C71CC9D, 0xE5EA7E2B, 0x70495003, 0x53ACF606, 0xF9CB8FD2, 0x2AB04508, 0x8DC54688,
    0xC6C09464, 0x76342803, 0x671712AF, 0x830C60A9, 0x8D2BE9A9, 0x68C2197B, 0x0448190B, 0x9E7C804B,
    0xBE94ECA7, 0xEA3ACF30, 0x15166D67, 0x97BCA39F, 0x0AED55C0, 0xC2F59A43, 0x06BC85F0, 0xD6DEA580,
    0xC3430882, 0x3851F6D3, 0x8CE4ACE5, 0x03110C7A, 0x48676171, 0xD94F0826, 0x221331BA, 0x4A56183F,
    0x84D98D9B, 0x7A83D172, 0xE2665BB8, 0x4A8A63C2, 0xC3D69D8D, 0x866BBA61, 0x9BED9F62, 0x75DC766E,
    0x8B9058B2, 0xE8170175, 0x1C3A76A4, 0x5EBE0B0C, 0xD5C51626, 0x0372605B, 0x636DF071, 0xFA613089,
    0xA6763C6B, 0x529B1700, 0xF419C3F0, 0x9A18107A, 0x726A560F, 0xD90CC492, 0x12010C98, 0x0C6665F2,
    0x73604F3B, 0x4593966A, 0x1F867B4A, 0xB8354D83, 0x47A6F838, 0xBC301677, 0xF6231FBC, 0xB67C88AA,
    0xCC82D5CB, 0xBACD4022, 0x50674186, 0x34C4436A, 0x75AD7EC2, 0x32D28444, 0x0CC43BA8, 0x68301822,
    0x200A0316, 0x70545A76, 0x2C5B7E21, 0x44638490, 0xC4C28BCD, 0xE870B798, 0x9D95D13C, 0xCBBC52C1,
    0x36ABCE4A, 0x61F3F7AB, 0xF547128C, 0x101320DB, 0x74E5A1C0, 0x397C54FA, 0x4AA4C58C, 0xB68536C2,
    0xF6B8074D, 0xC4164061, 0xC6711B27, 0x20B5A850, 0x8BA0AFA5, 0x16E54EA0, 0xFBA7B846, 0xF53A2D65,
    0x5510407A, 0xAC6F858F, 0x091E91C9, 0x87C532B3, 0xE861DB0E, 0x19BB50E8, 0x5557AE49, 0xCCA2FBC1,
    0x02732047, 0x2B54D69F, 0x791BA7CD, 0x11F8BC52, 0x882A8F60, 0xF2041A29, 0x11B14B66, 0x23B1272E,
    0x92C1165B, 0x794E2103, 0x8C315A14, 0x2D151051, 0x1AB26BA3, 0x118073CA, 0xB1B8D685, 0xB344A3F6,
    0x0F553E3B, 0xBC29DCB5, 0xE84698D1, 0xC8BB7440, 0xD30C58F7, 0x122FB547, 0x6C61D1A7, 0x1FCDA255,
    0x67A84A5C, 0x0F53DD02, 0x13645AA0, 0x2761A102, 0x52858E46, 0x7075562E, 0xF8C35FB6, 0x205AD834,
    0xB20E3A97, 0x81D510B2, 0x88FBFD2C, 0x06AAC31C, 0x7BB74CAB, 0x6BDC7CBA, 0x023CE5CE, 0xB943330B,
    0x98829ABD, 0xEE5520AD, 0x8470601A, 0x62A84091, 0x15187288, 0x773497C7, 0xCF97403F, 0x96CC4147,
    0x810CA335, 0x3307B200, 0x350B98D3, 0xACFA9303, 0x6EE6D04C, 0x81C63747, 0xD7C8BCDB, 0x74A73F95,
    0xAD22C454, 0x8B270E87, 0x3CC32111, 0x0E377382, 0x6A6A685B, 0xA3FC17AB, 0x40307AB6, 0x411249D6,
    0x72305EBF, 0x421EDCFB, 0x5BFA1324, 0x1EE99E4E, 0xE236C9B3, 0x56785C1A, 0xA5442F94, 0x88A67056,
    0xA9919EA6, 0x09F40BA8, 0xF71D304C, 0xAC4D3305, 0x9492CDB0, 0x349F8273, 0xD24779F3, 0x62C0552B,
    0x03F7CCF4, 0xC01C3CEE, 0xDD1673BA, 0x6E6B8E65, 0xFCF81508, 0xBBB1709A, 0x32EC25A3, 0x160993E2,
    0x05FDA888, 0x66A06DCD, 0x05B1BAD2, 0xE63E9B29, 0x5ABD0566, 0xAF603780, 0x3C03A656, 0x24B9D3B9,
    0x6C4D060A, 0x73ABCE06, 0xA9FC9CE5, 0x250264FF, 0xEF6A325A, 0x78B69C1E, 0x9D9236BF, 0x589AE2AF,
]);

// Taken from NIST test vectors: https://github.com/usnistgov/ACVP-Server/blob/master/gen-val/json-files/ML-KEM-encapDecap-FIPS203/internalProjection.json
const CAPS_EK: LEArray4x392 = LEArray4x392::new([
    0x70086939, 0xF5DD65B7, 0x2709B7A0, 0x1119EC73, 0x808A7E63, 0x5A867A30, 0x2F01E324, 0xD40FCCBA,
    0x442AD131, 0x85C68CB3, 0x87855C33, 0x87610214, 0x9341F6E8, 0xE0CB9132, 0x89D778B6, 0x7D7DB144,
    0xC0DE05A6, 0x1E68B811, 0xC0013711, 0x15534507, 0x3015E16E, 0x8F3BB6A4, 0x7B6386E8, 0x73E24D52,
    0x9195033D, 0x0CD90C23, 0x1EB6BA1E, 0xE462573A, 0x67604E6B, 0x80B2C4C6, 0xD8A371F3, 0x243968BB,
    0x81E3D32D, 0x24361AB4, 0x552C6C39, 0x9309187D, 0x801D904A, 0x431A7391, 0x2EA32DA3, 0x0F86FAC9,
    0x90D04AFC, 0xC644B922, 0x2F0D9854, 0xB5738792, 0x8A04BEBB, 0x673FDB21, 0xF2A77E16, 0x602456B1,
    0xC2CDAC14, 0xD1F55544, 0x1D17F7B0, 0x3DA4CA29, 0x25E31CEB, 0x498B0713, 0x9B9CC05A, 0x7B499367,
    0x0C5793B5, 0x1F2DAAF8, 0xD5E54975, 0x39A3A54F, 0x901C28B4, 0x019D5AD7, 0x2132B786, 0x1D0BB929,
    0x9298A3F6, 0x3D610AC6, 0x6EA4E455, 0xB6697BC0, 0x562596AF, 0x5179C717, 0xB7158A95, 0x7580C41D,
    0x6A232A56, 0x890025A3, 0x9975CF09, 0xA88AD53C, 0x09755816, 0x3E59FA85, 0x0B40C0F6, 0x19F17BA0,
    0x1D0B38C7, 0x431A7561, 0xB698A390, 0x95685A20, 0x63A457A8, 0xC21F93EC, 0x069BD862, 0xACB36C9D,
    0x27E5B49B, 0x61CA352F, 0xB646832D, 0x81702754, 0x2A42C986, 0x992B3337, 0x70BABF55, 0xB54C4580,
    0x83972397, 0x2165549B, 0x4D02C69E, 0xC46EA408, 0x24159AB2, 0x13F45396, 0x9EC9A1FD, 0xE744C182,
    0x7CE1D9BC, 0xD4C3C219, 0xF992473C, 0x48D8A41E, 0x2A396775, 0x34513AF4, 0x59599780, 0x55CA0CE5,
    0x0AAB89DC, 0xB113A319, 0xBDADE6B7, 0x2877147A, 0xB228D11B, 0xCC67F8C0, 0x247738D1, 0x8844588E,
    0x78B8482F, 0x20D536E5, 0x1BF11687, 0x33100575, 0xE90DA3E9, 0x63A6BBAF, 0x26BAE105, 0x9CB28656,
    0x3CFB8631, 0x362995A1, 0xA92EBDFA, 0x4ED7E031, 0xB69C844D, 0x38FCBF85, 0x5995E2C9, 0x2EAF6ADE,
    0x547C01B4, 0x97D5B93E, 0xC321B432, 0x8157CBA5, 0xA9F160BB, 0x797DF053, 0x1365B337, 0x6ED4E105,
    0x21935615, 0x04311E72, 0x16ECC294, 0xB4B343C8, 0x091883D9, 0x8FDA5B06, 0xE8175A4E, 0x2C312301,
    0xAC035C06, 0x55AF23E6, 0x1C36CE89, 0x35DA3B91, 0x421E035A, 0xA2AB4EC5, 0x84F6F34A, 0x32496C8E,
    0xA0E27A42, 0x8B80259D, 0xD48802DF, 0x29EA45C2, 0xCB61C273, 0xB1AFA629, 0xA358603C, 0x67119FA1,
    0x868F193A, 0x381151A2, 0x7FA2CD37, 0xE3A10423, 0xB88B5CD7, 0xA0676C8E, 0xDA63CC06, 0xB81700C9,
    0x6802DC65, 0x2C3EC5EF, 0xF1C65CB7, 0x83348B00, 0x260BC89C, 0x0C4419A0, 0x2B13340D, 0x190569C4,
    0x54E11D13, 0xB330B734, 0x6E2F49A2, 0xF11C47F6, 0x638456C5, 0x027138A3, 0xA8B15E13, 0x630A5F63,
    0x917631E3, 0x24CC404B, 0x0E2C0094, 0x0D8AC319, 0x56CAC097, 0x19152632, 0xF3303019, 0x81C6CE3A,
    0x5A3CD325, 0x979F6AF2, 0xA081B1B1, 0x44914E0E, 0x1D81D4A2, 0xB9F95476, 0x26E1CC58, 0xFEA730E0,
    0xBCA045C0, 0x05D42EB8, 0x3F3F6409, 0x52B63657, 0x08406A11, 0xA15FA6ED, 0x23C85E89, 0x3B71C290,
    0x6EBB0343, 0x64414B7B, 0xBCABD829, 0x90987B49, 0x65D02472, 0x015ADCB3, 0xF7BB0779, 0xB7089E07,
    0x59D0AF70, 0x93301AA3, 0x49EF8035, 0x0A8BC4B5, 0x975667CE, 0x1904B1D6, 0x2462DB92, 0x69379260,
    0xA00A9854, 0x5ACBCF3D, 0x0B6BA3DE, 0x34AE3821, 0x0F275E9D, 0x0B64830D, 0xC95C88E9, 0x90641C37,
    0x5999F3C1, 0xE592A1C9, 0xCBF9DF84, 0x97228C2D, 0xD7B917B1, 0xB2C57A62, 0x553593D2, 0xA7A51887,
    0xB06445C3, 0x5F10A1C0, 0x08E0000A, 0x5C18CA4A, 0x1E74545A, 0xA453404B, 0x78367131, 0x3F1D95F5,
    0x19077EE4, 0x7A0182A0, 0x2E893BB7, 0xCB7EC7F3, 0x86F30B17, 0x98C836AB, 0xE68ABC76, 0x2EB80C7B,
    0xD99327E4, 0x725143D7, 0xA38C3E04, 0x31A8E1A8, 0x21118997, 0xB20A2A93, 0x9E7846EF, 0xF5ED0BAB,
    0x4B7A70A5, 0xD35B0310, 0x291EB031, 0x12E17083, 0xD9483A44, 0x3850A96C, 0x5D49E332, 0x3771E5D2,
    0xB6571F4C, 0x74A0A0B9, 0x6C7329AA, 0xD8E18F48, 0xBD2A6623, 0xA49C373A, 0x31DE0730, 0x32D39273,
    0xCE6A82A6, 0xC8F41A38, 0xC7F7312C, 0x708C7881, 0x066F4E5C, 0x508848B1, 0x685BE5AA, 0x70157372,
    0x9AB44D44, 0x963EA5C9, 0x1C6C8135, 0x30247D53, 0x431222F9, 0x362B5917, 0x858586A6, 0xB234F39E,
    0x72502A78, 0x5CC561A6, 0x75492939, 0x47192357, 0x3DE3B44D, 0x885EDCFF, 0x6B3BA8AB, 0x5387468D,
    0x98A88BC8, 0xF06C11DB, 0x1CB45D41, 0x4646D317, 0xA4C4BA2B, 0xC9D00742, 0xC8714B3A, 0xB9470DD0,
    0xAB90C669, 0xBBC071B3, 0xA367A3E1, 0xC4436604, 0xE367C866, 0xB45E8041, 0x6331F835, 0x6A9EF658,
    0x54BB7649, 0xA90AD9AB, 0xDF2BB563, 0x7CA23BC9, 0xCCF53B83, 0x5BCAA2B4, 0x702DA1AB, 0x87CB6A01,
    0x6B418255, 0x4622A8A1, 0x9648E8CA, 0x9069B347, 0x358E12F9, 0x61CB0704, 0x496E924C, 0x80D7B62B,
    0xB53CE721, 0x7F314146, 0x43B982F2, 0x3B186264, 0xD3A57593, 0x5A357928, 0x315B2196, 0x939CE0AC,
    0x26409277, 0x74B9B80E, 0x079404FE, 0x8B809B22, 0x2C141878, 0xC51C073A, 0x59561F56, 0x3405763E,
    0x7F81636C, 0x6A830BEB, 0x776078BB, 0x357E7ABC, 0x165C2711, 0x7C01A90B, 0x954E7757, 0x298C0403,
    0xC9F559B9, 0xE1A854E3, 0xC872CD37, 0x7819AD73, 0xDC2493F6, 0xE0042528, 0x1BFB21A2, 0xA6040074,
    0xD3A2A73A, 0x0DBD003E, 0xB86299A2, 0xC73302F3, 0x2CF21783, 0xF168D0E7, 0x9922176C, 0x00E82542,
    0x72051E49, 0x1BD80132, 0xD0103EE6, 0xFFE10255, 0x92045854, 0x8256DCD7, 0x859EF0EB, 0x614E3B77,
]);
const CAPS_DK: LEArray4x792 = LEArray4x792::new([
    0xA9242C04, 0xEBED5F41, 0x4EF33249, 0x6205D3C4, 0xE6402711, 0x7F692102, 0xDA24CBFE, 0x14D78808,
    0x2479CD56, 0xB09D66E9, 0xC3EB1115, 0x2CECF6AB, 0xFD461129, 0xC3CC0EC9, 0xA9BC70A2, 0x1A2D3338,
    0xEC9C0109, 0x7F8C5FC3, 0x6219C48F, 0xB7D58521, 0x2D5C8634, 0xD034A6D4, 0xEA98B081, 0x91021A31,
    0xB673C969, 0xCC62C043, 0x38D7317E, 0xAC1D7376, 0x5A9530F8, 0xBCB9737F, 0xACB6D6C9, 0x47F76841,
    0x3C3A5D88, 0xEF4ACA01, 0xB5F50EA2, 0xAE76B15F, 0x129C9390, 0x32A92B00, 0x2AAA5247, 0x3A8FF71D,
    0xE5FE3468, 0xA465510B, 0xACCA0BAE, 0xA9C6BC06, 0x9EA6949E, 0x0752E681, 0x10C12AF5, 0x90BAEC88,
    0x8BCE1216, 0xCB8877A6, 0x74139DB6, 0xFFA7F379, 0x83FB1325, 0x6D94CA20, 0xD652A9DC, 0xA0A5673A,
    0x495229AB, 0xA56961C7, 0xBB1599E0, 0xC8F2FB7D, 0x4697C876, 0x979A2B3C, 0xC406593E, 0x4FA0D710,
    0x13280DAA, 0xBBC58CC4, 0xA7C433F7, 0x199A1306, 0x1E9BFA90, 0x5886A978, 0x83504236, 0x12F8347B,
    0x4A624607, 0xD82F7CD6, 0x3A2CD9C5, 0xC000F30F, 0xB08C9894, 0x5465FA77, 0x0394557E, 0x82F1AF57,
    0x11F5CD66, 0xE46940E7, 0x569757A8, 0x77D30048, 0xFE53E0AC, 0xC6BB19A9, 0x5F356948, 0x3E811806,
    0x5B1E3C60, 0x4D622D55, 0x644D9237, 0xC67134B8, 0x63F76E18, 0xCA19F3E9, 0x33910041, 0xCC450D36,
    0x67863CFB, 0xEAF1ABD3, 0x3639E47C, 0xBF9EEC83, 0x3CCDB388, 0xBFA6303D, 0xFE31D866, 0xE9B75C23,
    0x2143E15A, 0xA56EB7FD, 0xC2DD4593, 0x5D6C4F1D, 0xA605517F, 0x68DD9C7C, 0x2372F018, 0x8F5197EE,
    0x26E566A6, 0x6789F4A0, 0x0547007B, 0x2B5F0E77, 0x0AD9AE68, 0x4BC5691E, 0x1C90A6D0, 0x77346B76,
    0x6C34DAC1, 0x5B7F2195, 0xB275448A, 0xB2A7C0D6, 0x514F8A70, 0xA6D1EC9E, 0x65376A7B, 0xFA1E3C00,
    0xAC798430, 0x4D4B58B7, 0xF3A09A38, 0xC2780520, 0xABB46A83, 0x79862653, 0x78C0A93B, 0x7758ECA1,
    0xD5DFC655, 0x16F4EDB7, 0x5C46A384, 0xE80D3DAB, 0xC1837B0E, 0xC753796E, 0x3B317ABC, 0xB268BB2D,
    0x6976EC04, 0xECB30A73, 0x910C61AF, 0x23032358, 0x8A4B6AA8, 0x8F2A17B0, 0x5F82927E, 0x62137F8C,
    0xA4A44CCB, 0xC17319ED, 0x0A1220D6, 0x8EF88E63, 0x1FC178AE, 0x0856B090, 0x93125909, 0x545DDBA3,
    0x383CCE09, 0x911C7D81, 0x5080AB7E, 0xA69AC6E8, 0x7831F3C8, 0x6C9E1AB0, 0x0BB61DD3, 0x4574FB15,
    0x649214A4, 0x86FB84D9, 0xA7B65EAA, 0x7F0E707F, 0xABE19058, 0xA415C7C2, 0x2B19235B, 0xDA4A79D2,
    0x3588BE65, 0x6395DBF2, 0xB6642DB3, 0x4D225759, 0x6A7230CE, 0x7AAF6863, 0x776B013E, 0x1D67A412,
    0x341746F3, 0x1193EF11, 0xA11A079B, 0x44C66797, 0x7131DD74, 0x7C04C174, 0x965501E6, 0x61E68279,
    0x931C44BE, 0xC3CFA163, 0xCEA77C3C, 0xB10C626A, 0x5CD77938, 0xC522E392, 0x6A0C9C0C, 0xEB921404,
    0x261BDA5A, 0x8B13A07F, 0xD8EFA363, 0x33F9C3A2, 0xF505E80C, 0x23656051, 0x899C2B0E, 0xB03BACA2,
    0xF8F031C2, 0xCD6552A5, 0xDB223C14, 0x00A93F87, 0x3E7A0268, 0x31542721, 0x6AEC2F92, 0x44F5E5A8,
    0x8C9F38A3, 0xB81E05DB, 0x0D25C549, 0x8F3DD627, 0xA1C28D39, 0x6F01E872, 0xD423B2AD, 0x5BD59D7B,
    0x403012C0, 0xCFB39509, 0xC9161BA5, 0x4E8BEB03, 0xE704974A, 0xD16C0048, 0xB7250971, 0xD5CC0050,
    0xD83C4F72, 0x938CC61B, 0xFC6BE364, 0x27422897, 0x2DAAFA4D, 0x98628185, 0x60651BC5, 0x892C5292,
    0x191B9B5B, 0xB21F9A39, 0x9534458B, 0xEBC6512D, 0xA112CE16, 0x4EC63868, 0x902C94BE, 0xC39068A0,
    0x00186C24, 0x3863F5C0, 0x44279334, 0x8347B5B8, 0x2F27D764, 0x5A7DC980, 0x7EA3190E, 0x1228186B,
    0x5C4B60A0, 0xA1743235, 0x4829DA39, 0x42D17E39, 0xB502F986, 0xF57F9B42, 0xBB4AC8F4, 0xA8E1A73F,
    0x894C9705, 0x06C907AA, 0xC7739A10, 0x2958B0B1, 0xF1FFA267, 0xCA89B237, 0x073BFA0A, 0x0A7521C2,
    0xB660C97C, 0x6AB679A6, 0x587373A3, 0xA759845F, 0xC75B72E3, 0xA02F3818, 0xAF33D43B, 0xE51B48AC,
    0x206D9BA0, 0x9CBCDB75, 0xBC92BB4C, 0xD5905091, 0xCAACA503, 0x60A3C2FC, 0xFA652714, 0x5DA59925,
    0x2D6A5AC0, 0x63F80053, 0x05DBE7BF, 0xD702A174, 0xA073176C, 0x8B82F395, 0xB9B0B7EA, 0x0C9DB145,
    0xB6948228, 0x1F55FAEC, 0x58FB26BA, 0x94F38FBA, 0x74ACAB99, 0x559990B9, 0xA2E5CC92, 0xBC2586EC,
    0x60436CE2, 0xC1655B87, 0x181A83D1, 0xE73C3054, 0x51851980, 0x622C5C01, 0x70FBAAF9, 0x3458A1B1,
    0x42A667D4, 0x99BF80B1, 0x77223B39, 0x06370B4E, 0xE27A1A42, 0x1B2841CF, 0x1E8915AE, 0x31749F42,
    0x023BA64B, 0xC261A6E0, 0x47A91E89, 0xC41C57B7, 0xD749D77E, 0x2095050B, 0x4A57D73D, 0xDFAED6FD,
    0xFA55BE8C, 0x6253495D, 0x374C53DD, 0xDAEB26B9, 0xCB488A46, 0x65051C70, 0xC49419A8, 0x2299C5AF,
    0x6763C93A, 0x2163967C, 0x98867B1D, 0x3E6733D5, 0xBBC45683, 0xCAB6776F, 0x523927D0, 0x0A5F6270,
    0xA8B5D580, 0x951CE681, 0xF965C153, 0x9B302BCA, 0xB51CB2A7, 0x55293916, 0x84987F61, 0x97C75BA7,
    0x228D09F1, 0x8519826F, 0x75697607, 0x1A841830, 0x7001299F, 0xD1712725, 0x5BFBA84B, 0xAA33FBCD,
    0x32607BA1, 0x080A54D3, 0x214658B8, 0x04C4B02A, 0xA709A230, 0xB5204424, 0xFF5713A8, 0x44499A66,
    0xB5EB1A29, 0xA83ECC0E, 0xD2362296, 0x03CCF8C4, 0x27480754, 0xBC7EA3D0, 0xA99212A1, 0x067F1AD4,
    0xC2377CD9, 0xAF931554, 0x1943AB33, 0x2245CB35, 0xA7510637, 0x2955CC84, 0x9692CACC, 0x72F88B51,
    0x70086939, 0xF5DD65B7, 0x2709B7A0, 0x1119EC73, 0x808A7E63, 0x5A867A30, 0x2F01E324, 0xD40FCCBA,
    0x442AD131, 0x85C68CB3, 0x87855C33, 0x87610214, 0x9341F6E8, 0xE0CB9132, 0x89D778B6, 0x7D7DB144,
    0xC0DE05A6, 0x1E68B811, 0xC0013711, 0x15534507, 0x3015E16E, 0x8F3BB6A4, 0x7B6386E8, 0x73E24D52,
    0x9195033D, 0x0CD90C23, 0x1EB6BA1E, 0xE462573A, 0x67604E6B, 0x80B2C4C6, 0xD8A371F3, 0x243968BB,
    0x81E3D32D, 0x24361AB4, 0x552C6C39, 0x9309187D, 0x801D904A, 0x431A7391, 0x2EA32DA3, 0x0F86FAC9,
    0x90D04AFC, 0xC644B922, 0x2F0D9854, 0xB5738792, 0x8A04BEBB, 0x673FDB21, 0xF2A77E16, 0x602456B1,
    0xC2CDAC14, 0xD1F55544, 0x1D17F7B0, 0x3DA4CA29, 0x25E31CEB, 0x498B0713, 0x9B9CC05A, 0x7B499367,
    0x0C5793B5, 0x1F2DAAF8, 0xD5E54975, 0x39A3A54F, 0x901C28B4, 0x019D5AD7, 0x2132B786, 0x1D0BB929,
    0x9298A3F6, 0x3D610AC6, 0x6EA4E455, 0xB6697BC0, 0x562596AF, 0x5179C717, 0xB7158A95, 0x7580C41D,
    0x6A232A56, 0x890025A3, 0x9975CF09, 0xA88AD53C, 0x09755816, 0x3E59FA85, 0x0B40C0F6, 0x19F17BA0,
    0x1D0B38C7, 0x431A7561, 0xB698A390, 0x95685A20, 0x63A457A8, 0xC21F93EC, 0x069BD862, 0xACB36C9D,
    0x27E5B49B, 0x61CA352F, 0xB646832D, 0x81702754, 0x2A42C986, 0x992B3337, 0x70BABF55, 0xB54C4580,
    0x83972397, 0x2165549B, 0x4D02C69E, 0xC46EA408, 0x24159AB2, 0x13F45396, 0x9EC9A1FD, 0xE744C182,
    0x7CE1D9BC, 0xD4C3C219, 0xF992473C, 0x48D8A41E, 0x2A396775, 0x34513AF4, 0x59599780, 0x55CA0CE5,
    0x0AAB89DC, 0xB113A319, 0xBDADE6B7, 0x2877147A, 0xB228D11B, 0xCC67F8C0, 0x247738D1, 0x8844588E,
    0x78B8482F, 0x20D536E5, 0x1BF11687, 0x33100575, 0xE90DA3E9, 0x63A6BBAF, 0x26BAE105, 0x9CB28656,
    0x3CFB8631, 0x362995A1, 0xA92EBDFA, 0x4ED7E031, 0xB69C844D, 0x38FCBF85, 0x5995E2C9, 0x2EAF6ADE,
    0x547C01B4, 0x97D5B93E, 0xC321B432, 0x8157CBA5, 0xA9F160BB, 0x797DF053, 0x1365B337, 0x6ED4E105,
    0x21935615, 0x04311E72, 0x16ECC294, 0xB4B343C8, 0x091883D9, 0x8FDA5B06, 0xE8175A4E, 0x2C312301,
    0xAC035C06, 0x55AF23E6, 0x1C36CE89, 0x35DA3B91, 0x421E035A, 0xA2AB4EC5, 0x84F6F34A, 0x32496C8E,
    0xA0E27A42, 0x8B80259D, 0xD48802DF, 0x29EA45C2, 0xCB61C273, 0xB1AFA629, 0xA358603C, 0x67119FA1,
    0x868F193A, 0x381151A2, 0x7FA2CD37, 0xE3A10423, 0xB88B5CD7, 0xA0676C8E, 0xDA63CC06, 0xB81700C9,
    0x6802DC65, 0x2C3EC5EF, 0xF1C65CB7, 0x83348B00, 0x260BC89C, 0x0C4419A0, 0x2B13340D, 0x190569C4,
    0x54E11D13, 0xB330B734, 0x6E2F49A2, 0xF11C47F6, 0x638456C5, 0x027138A3, 0xA8B15E13, 0x630A5F63,
    0x917631E3, 0x24CC404B, 0x0E2C0094, 0x0D8AC319, 0x56CAC097, 0x19152632, 0xF3303019, 0x81C6CE3A,
    0x5A3CD325, 0x979F6AF2, 0xA081B1B1, 0x44914E0E, 0x1D81D4A2, 0xB9F95476, 0x26E1CC58, 0xFEA730E0,
    0xBCA045C0, 0x05D42EB8, 0x3F3F6409, 0x52B63657, 0x08406A11, 0xA15FA6ED, 0x23C85E89, 0x3B71C290,
    0x6EBB0343, 0x64414B7B, 0xBCABD829, 0x90987B49, 0x65D02472, 0x015ADCB3, 0xF7BB0779, 0xB7089E07,
    0x59D0AF70, 0x93301AA3, 0x49EF8035, 0x0A8BC4B5, 0x975667CE, 0x1904B1D6, 0x2462DB92, 0x69379260,
    0xA00A9854, 0x5ACBCF3D, 0x0B6BA3DE, 0x34AE3821, 0x0F275E9D, 0x0B64830D, 0xC95C88E9, 0x90641C37,
    0x5999F3C1, 0xE592A1C9, 0xCBF9DF84, 0x97228C2D, 0xD7B917B1, 0xB2C57A62, 0x553593D2, 0xA7A51887,
    0xB06445C3, 0x5F10A1C0, 0x08E0000A, 0x5C18CA4A, 0x1E74545A, 0xA453404B, 0x78367131, 0x3F1D95F5,
    0x19077EE4, 0x7A0182A0, 0x2E893BB7, 0xCB7EC7F3, 0x86F30B17, 0x98C836AB, 0xE68ABC76, 0x2EB80C7B,
    0xD99327E4, 0x725143D7, 0xA38C3E04, 0x31A8E1A8, 0x21118997, 0xB20A2A93, 0x9E7846EF, 0xF5ED0BAB,
    0x4B7A70A5, 0xD35B0310, 0x291EB031, 0x12E17083, 0xD9483A44, 0x3850A96C, 0x5D49E332, 0x3771E5D2,
    0xB6571F4C, 0x74A0A0B9, 0x6C7329AA, 0xD8E18F48, 0xBD2A6623, 0xA49C373A, 0x31DE0730, 0x32D39273,
    0xCE6A82A6, 0xC8F41A38, 0xC7F7312C, 0x708C7881, 0x066F4E5C, 0x508848B1, 0x685BE5AA, 0x70157372,
    0x9AB44D44, 0x963EA5C9, 0x1C6C8135, 0x30247D53, 0x431222F9, 0x362B5917, 0x858586A6, 0xB234F39E,
    0x72502A78, 0x5CC561A6, 0x75492939, 0x47192357, 0x3DE3B44D, 0x885EDCFF, 0x6B3BA8AB, 0x5387468D,
    0x98A88BC8, 0xF06C11DB, 0x1CB45D41, 0x4646D317, 0xA4C4BA2B, 0xC9D00742, 0xC8714B3A, 0xB9470DD0,
    0xAB90C669, 0xBBC071B3, 0xA367A3E1, 0xC4436604, 0xE367C866, 0xB45E8041, 0x6331F835, 0x6A9EF658,
    0x54BB7649, 0xA90AD9AB, 0xDF2BB563, 0x7CA23BC9, 0xCCF53B83, 0x5BCAA2B4, 0x702DA1AB, 0x87CB6A01,
    0x6B418255, 0x4622A8A1, 0x9648E8CA, 0x9069B347, 0x358E12F9, 0x61CB0704, 0x496E924C, 0x80D7B62B,
    0xB53CE721, 0x7F314146, 0x43B982F2, 0x3B186264, 0xD3A57593, 0x5A357928, 0x315B2196, 0x939CE0AC,
    0x26409277, 0x74B9B80E, 0x079404FE, 0x8B809B22, 0x2C141878, 0xC51C073A, 0x59561F56, 0x3405763E,
    0x7F81636C, 0x6A830BEB, 0x776078BB, 0x357E7ABC, 0x165C2711, 0x7C01A90B, 0x954E7757, 0x298C0403,
    0xC9F559B9, 0xE1A854E3, 0xC872CD37, 0x7819AD73, 0xDC2493F6, 0xE0042528, 0x1BFB21A2, 0xA6040074,
    0xD3A2A73A, 0x0DBD003E, 0xB86299A2, 0xC73302F3, 0x2CF21783, 0xF168D0E7, 0x9922176C, 0x00E82542,
    0x72051E49, 0x1BD80132, 0xD0103EE6, 0xFFE10255, 0x92045854, 0x8256DCD7, 0x859EF0EB, 0x614E3B77,
    0xFB29EDD4, 0x27C6EF6E, 0x2E82249C, 0xB6E90FBB, 0x1E934692, 0x527346D0, 0x799EE6B7, 0xEAF67CF4,
    0x99906EF3, 0xE94779A6, 0xE6AD787C, 0x1663B3C5, 0x5F026C33, 0x5B33E716, 0x58311AD8, 0x7EC8AFD5,
]);
const CAPS_C: LEArray4x392 = LEArray4x392::new([
    0xAFDB25FB, 0xCE7DCDA2, 0x0EE99B97, 0xCC9F1731, 0x8AED4AC2, 0x3B0CD686, 0x706FDD84, 0xFB9A241B,
    0x6F92EEEA, 0x819F8505, 0xFA56B38C, 0x633B59D2, 0x94E5B640, 0x8EE7D780, 0x314DC554, 0x22E1BD78,
    0x0B01D3F0, 0x652BBFA5, 0x08208246, 0xE130F48D, 0xE1164497, 0xB3B3F52B, 0x3A2ACCEA, 0x4638C0BF,
    0x7A25830D, 0x28F4C78C, 0x003D6B3C, 0x8B8CDA70, 0x6C97EBCE, 0x058D700D, 0x6EC8046F, 0x991EB835,
    0x26C72A16, 0x98A3F318, 0xB390FB32, 0x4E91DC78, 0x14F33207, 0x49B14900, 0x008D2C29, 0x059CDDAD,
    0x17BBF322, 0xAB4A0775, 0x9B271E4F, 0x8DE84659, 0xFFCC467C, 0x62553B45, 0x41B81718, 0x0BBD241E,
    0x75C2BD90, 0x64812A82, 0x47F911BA, 0x3DB0E97A, 0x10A0DEE7, 0x4E160B10, 0x0A1FA902, 0x584BB827,
    0x4A8DC45C, 0x170A4BB8, 0xBE4B4527, 0xB7E8B184, 0x7ABCC223, 0x65FAFB4E, 0xADE7087F, 0xC4CD7026,
    0xF334D597, 0x65622407, 0x06B49AC8, 0x01112E6E, 0x8E322A28, 0x581BCD00, 0x243FD2E4, 0xD94C36CC,
    0x481F892F, 0x74D9FF15, 0xD2C436ED, 0x7F0C3C9E, 0x910E2F30, 0x2280102E, 0x6CED3421, 0x35863C97,
    0xA3632F06, 0x96EC6297, 0x12A083C8, 0x6B5669F3, 0xFC5AFA62, 0x281E2E14, 0xC1E77546, 0x534447EB,
    0xE95DEC3E, 0xACADB85A, 0xDD5972E2, 0xB45365F7, 0x3FB8CD82, 0x63C61414, 0x829F3807, 0x9A941BA5,
    0x5ECFCAFA, 0x4577D638, 0x80A18C6A, 0x3B2EC86C, 0xDC4E88EA, 0xD65E4C7B, 0x43B10760, 0xFE9AA1F1,
    0xFA40551A, 0xFE99F969, 0xE16F3886, 0xE5C03FE8, 0x35DF2374, 0xAC4927E8, 0xF0D356C8, 0x9195FB5E,
    0xC903CF69, 0xD8113DCB, 0x851FBA8F, 0x3F219F97, 0x4B089FC5, 0xBDFEF401, 0xC060B59C, 0xF0F869F9,
    0x4406C321, 0xCD2187FC, 0xBBE2E212, 0x9DB31400, 0x6F91B49F, 0x8D6F8CD3, 0x7DD6029B, 0x3243A4CD,
    0x289551DC, 0x16D56DA8, 0x104C8B1E, 0x58CCDF0C, 0x6357E0E3, 0x695EFEE9, 0x285C5DCC, 0x24ABD2E6,
    0x3285BFA4, 0xDACBA364, 0xA32AA7E0, 0xD07CD380, 0x0D7706D3, 0x1DBA1B71, 0xE73EA155, 0x257001CA,
    0xE57BB556, 0xB6FD02F0, 0x00DE00CE, 0x9086F2CE, 0xE43C8092, 0xA644494F, 0x302BCA0C, 0xFA398F97,
    0xA6964A64, 0x5E705661, 0xBF73E4F1, 0x39B1EA38, 0x2383C7AE, 0x49CA7204, 0x17A871D0, 0xB8915137,
    0x63BFA991, 0x28F03B72, 0x43F4D130, 0xC5330B66, 0x8FBDCEEB, 0x81E44BE0, 0x2AE80924, 0xC5218AD4,
    0xEE1C240C, 0xB46A12D5, 0xE0AD4801, 0x81B3128E, 0x71543E62, 0x72E273D1, 0x08B9AA2D, 0x60021559,
    0xEA7E5388, 0x20C754D0, 0x681BFA7F, 0xDC75CCF9, 0xB740D534, 0xFC783F93, 0x842857FE, 0xC008F81A,
    0xF6839DFB, 0xE6BC0EA8, 0x373415B5, 0x275EB50D, 0x16D2744B, 0x9F7549C2, 0x4E49D980, 0xD00AFEA1,
    0xFE57F058, 0x9F75723C, 0x357B785F, 0xBE3F3CB1, 0x2430B7C4, 0xFE56004C, 0x1C804D69, 0x1FFC1D02,
    0xBBF69F17, 0x8E873584, 0xFF3689AB, 0xFF68ADDC, 0xD1ADBEBC, 0x693ACDBA, 0xA09D7522, 0x93AD721E,
    0x0FD1343F, 0x7044D729, 0xA33206F7, 0x1BBADAD6, 0x45E99D06, 0x8AE5159D, 0xE23021E1, 0x2CF94D41,
    0xFEBDDC36, 0x17EBC32E, 0x039373E3, 0xFB10D85E, 0x71D957B8, 0x4713D4EC, 0x8D5C9CB0, 0x0E06ABEE,
    0x9A545927, 0x2C7AC305, 0xF90CF393, 0x99C5A906, 0x1892DA91, 0xEB3C3648, 0x1499CF06, 0x35166EE7,
    0xA53703AA, 0x9B0C4740, 0x52D1583E, 0xB32A69FE, 0x3E5FABA1, 0x8459725C, 0xD4B9DF28, 0x20C3776E,
    0x941ECC01, 0xA1A40229, 0x26D594CD, 0x163C2D04, 0xF4A779AE, 0xCC6AF040, 0x5E441E33, 0xA3CEFB47,
    0x422D5BAD, 0xC320E337, 0x6CD11FDF, 0x93AD99BA, 0x71D936B1, 0x3823D7F4, 0x5EEDF198, 0xDEE41740,
    0xE643225B, 0xC476D7AD, 0xB6281E59, 0xA4FFA5F4, 0x37277DAD, 0xC8C7D208, 0x0D8AA22B, 0x109A1E62,
    0x7563E8FA, 0xABCB8F0C, 0xD9F1F3CC, 0xBD2F9E2E, 0xB6443D5D, 0xA7A1C1C4, 0x3352343C, 0xDBB8A856,
    0x6A7E8E1B, 0x2FA0B9F8, 0x5D703CA0, 0x6E8D57EC, 0xB91A7FCE, 0xFB8F49C9, 0x4231281E, 0x2B3458B2,
    0x6E9B9553, 0xFD23BD60, 0x44534AA2, 0xF5A64970, 0x6E5B52BD, 0xBE60DD12, 0xA07BCCB5, 0xAEED45E2,
    0xC09A48A2, 0xBACDABAC, 0xF313614C, 0x0DE3BF5A, 0xB62B3369, 0x43D15DB0, 0xAAA6E90F, 0x56E8AAC0,
    0xC31A39F0, 0x50071408, 0x84B7F885, 0x1BDD9E43, 0xFAFD55CF, 0x4F424201, 0x920A9E7A, 0x97F32A14,
    0x8D603D9C, 0x9F9BE92C, 0xD4B3F963, 0x751F4787, 0xFB3FC4D2, 0x7D4837D1, 0x93A8D9D9, 0x2299421D,
    0xB17FE661, 0x40BC31C5, 0xFB110750, 0x84AAB283, 0x06AD08C3, 0x6939E61B, 0xFD2D3F8F, 0xD96428B7,
    0x8A88F050, 0xBC611296, 0xB7DBC0A7, 0xB8DF9B8B, 0xE3514A02, 0xAA878D48, 0x03D78FEF, 0x38E559A8,
    0xE80D6F88, 0x90AC168A, 0x6296C5D2, 0xE8E2342E, 0x915F68D9, 0x6AE86B8B, 0x73BDE3B5, 0xC9214A19,
    0xFE53DBA4, 0x27E0880C, 0x2106FBD8, 0xA8A82B59, 0xCE678274, 0xA7DFBE6E, 0xDEE24451, 0xFB391B1C,
    0xF9958015, 0x7227A1FE, 0x8E716A21, 0x83E52947, 0x8B6D51B1, 0x3637F1DD, 0xAA736094, 0x9A2FE771,
    0x6CDD68A0, 0x7D2C6D3E, 0x1167C66B, 0x5AD74BB9, 0xDDDC58D5, 0x0095A177, 0x2239BB96, 0x03FD82A4,
    0xA59BEDB8, 0x8300EC3D, 0x2819B2A8, 0x09F5CE48, 0x68FF502D, 0xADA22376, 0x5E7DBADC, 0x9D75159B,
    0x6C5B53BB, 0xCF01BA1A, 0xADBC57B8, 0x0F6F50C6, 0x64DD733E, 0x053AC89B, 0xBE0CA6FA, 0x45F556D6,
    0xA8302E73, 0x785CF938, 0x7730D679, 0xE18485C1, 0x44F8E291, 0x63FD4FD4, 0x613D22C9, 0x853681E3,
    0x10F6FE6D, 0xA02D81BD, 0xF28FE1B8, 0xE90F5A46, 0xF98A65F4, 0xB148D94E, 0x0A714E3B, 0x20363DF0,
]);
const CAPS_K: LEArray4x8 = LEArray4x8::new([
    0xD07C535D, 0xF0587BEF, 0x043795FE, 0x7868B973, 0xC2EC38F1, 0xF7FBAD59, 0x2873BD7E, 0xD9D922B8,
]);
const CAPS_M: LEArray4x8 = LEArray4x8::new([
    0x92CF9981, 0x2621E13C, 0x56080192, 0xF9CB119C, 0x443FF07C, 0x7DFA5CAF, 0x2A9B0E55, 0x821943C7,
]);

pub fn execute_mlkem1024_kat(mlkem: &mut MlKem1024<'_>) -> CaliptraResult<()> {
    cprintln!("[kat] MLKEM1024");
    kat_keygen(mlkem)?;
    kat_encaps_decaps(mlkem)?;
    Ok(())
}

/// Test key pair generation against NIST test vectors.
fn kat_keygen(mlkem: &mut MlKem1024<'_>) -> CaliptraResult<()> {
    let seeds = MlKem1024Seeds::Arrays(&KEYGEN_SEED_D, &KEYGEN_SEED_Z);
    let (ek, dk) = mlkem
        .key_pair(seeds)
        .map_err(|_| CaliptraError::KAT_MLKEM1024_KEY_PAIR_GENERATE_FAILURE)?;

    if ek != KEYGEN_EK || dk != KEYGEN_DK {
        Err(CaliptraError::KAT_MLKEM1024_KEY_PAIR_VERIFY_FAILURE)?;
    }

    Ok(())
}

/// Test encapsulation and decapsulation against NIST test vectors.
fn kat_encaps_decaps(mlkem: &mut MlKem1024<'_>) -> CaliptraResult<()> {
    // Encapsulate
    let mut shared_key_enc = MlKem1024SharedKey::default();
    let ciphertext = mlkem
        .encapsulate(
            &CAPS_EK,
            MlKem1024MessageSource::Array(&CAPS_M),
            MlKem1024SharedKeyOut::Array(&mut shared_key_enc),
        )
        .map_err(|_| CaliptraError::KAT_MLKEM1024_ENCAPSULATE_FAILURE)?;

    if ciphertext != CAPS_C {
        Err(CaliptraError::KAT_MLKEM1024_SHARED_KEY_MISMATCH)?;
    }

    if shared_key_enc != CAPS_K {
        Err(CaliptraError::KAT_MLKEM1024_SHARED_KEY_MISMATCH)?;
    }

    // Decapsulate
    let mut shared_key_dec = MlKem1024SharedKey::default();
    mlkem
        .decapsulate(
            &CAPS_DK,
            &ciphertext,
            MlKem1024SharedKeyOut::Array(&mut shared_key_dec),
        )
        .map_err(|_| CaliptraError::KAT_MLKEM1024_DECAPSULATE_FAILURE)?;

    if shared_key_dec != CAPS_K {
        Err(CaliptraError::KAT_MLKEM1024_SHARED_KEY_MISMATCH)?;
    }

    Ok(())
}
