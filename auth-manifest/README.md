## SOC Manifest

The Caliptra SOC manifest has two main components:

- ### **Preamble**

 The Preamble section contains the authorization manifest ECC and LMS public keys of the vendor and the owner. These public keys correspond to the private keys that sign the Image Metadata Collection (IMC) section. These signatures are included in the Preamble. The Caliptra firmware’s ECC and LMS private keys endorse the manifest’s public keys, and these endorsements (signatures) are part of the Preamble as well.

 *Note: All fields are little endian unless specified*

| Field                    | Size (bytes) | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ------------------------ | ------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Manifest Marker          | 4            | Magic Number marking the start of the manifest. The value must be 0x41544D4E (‘ATMN’ in ASCII)                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Manifest Size            | 4            | Size of the full manifest structure                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Version                  | 4            | Manifest version. The current version is 0x00000002.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| SVN                      | 4            | Security Version Number used for anti-rollback.<br />The maximum value is vendor-defined and is limited by the maximum size of the Caliptra fuse allocated for anti-rollback.                                                                                                                                                                                                                                                                                                                                                 |
| Flags                    | 4            | Feature flags.<br />**Bit0:** - Vendor Signature Required. If set, the vendor public keys will be used to verify the signatures signed with the <br />vendor private key. Otherwise, vendor signatures will not be used for verification.<br />**Bit1-Bit31:** Reserved                                                                                                                                                                                                                                           |
| Vendor ECC Public Key    | 96           | Vendor ECC P-384 public key used to verify the IMC Signature.<br />**X-Coordinate:** Public Key X-Coordinate (48 bytes) <br /> **Y-Coordinate:** Public Key Y-Coordinate (48 bytes)                                                                                                                                                                                                                                                                                                                               |
| Vendor LMS Public Key    | 48           | Vendor LMS-SHA192-H15 public key used to verify the IMC Signature<br />**tree_type:** LMS Algorithm Type (4 bytes)<br />**otstype:** LMS Ots Algorithm Type (4 bytes) <br />**id:**  (16 bytes) <br />**digest:**  (24 bytes) <br /> Note: If LMS validation is not required, this field should be zeroed out.                                                                                                                                                                                       |
| Vendor ECC Signature     | 96           | Vendor ECDSA P-384 signature of the Version, SVN, Flags, Vendor ECC and LMS public keys, hashed using SHA2-384.<br />**R-Coordinate:** Random Point (48 bytes)<br />**S-Coordinate:** Proof (48 bytes)                                                                                                                                                                                                                                                                                                            |
| Vendor LMS Signature     | 1620         | Vendor LMOTS-SHA192-W4 signature of the Version, SVN, Flags, Vendor ECC and LMS public keys, hashed using SHA2-384.<br />**q:** Leaf of the Merkle tree where the OTS public key appears (4 bytes)<br />**ots:** Lmots Signature (1252 bytes)<br />**tree_type:** Lms Algorithm Type (4 bytes) <br />**tree_path:** Path through the tree from the leaf associated with the LM-OTS signature to the root. (360 bytes) <br />Note: If LMS validation is not required, this field should be zeroed out. |
| Owner ECC Public Key     | 96           | Owner ECC P-384 public key used to verify the IMC Signature.<br />**X-Coordinate:** Public Key X-Coordinate (48 bytes)<br />**Y-Coordinate:** Public Key Y-Coordinate (48 bytes)                                                                                                                                                                                                                                                                                                                                  |
| Owner LMS Public Key     | 48           | Owner LMS-SHA192-H15 public key used to verify the IMC Signature.<br />**tree_type:** LMS Algorithm Type (4 bytes)<br />**otstype:** LMS Ots Algorithm Type (4 bytes)<br />**id:**  (16 bytes)<br />**digest:**  (24 bytes)<br />Note: If LMS validation is not required, this field should be zeroed out.                                                                                                                                                                                            |
| Owner ECC Signature      | 96           | Owner ECDSA P-384 signature of the Version, SVN, Flags, Owner ECC and LMS public keys, hashed using SHA2-384.<br />**R-Coordinate:** Random Point (48 bytes)<br />**S-Coordinate:** Proof (48 bytes)                                                                                                                                                                                                                                                                                                              |
| Owner LMS Signature      | 1620         | Owner LMOTS-SHA192-W4 signature of the Version, SVN, Flags, Owner ECC and LMS public keys, hashed using SHA2-384.<br />**q:** Leaf of the Merkle tree where the OTS public key appears (4 bytes)<br />**ots:** Lmots Signature (1252 bytes) <br />**tree_type:** Lms Algorithm Type (4 bytes) <br />**tree_path:** Path through the tree from the leaf associated with the LM-OTS signature to the root. (360 bytes) <br />Note: If LMS validation is not required, this field should be zeroed out.  |
| IMC Vendor ECC Signature | 96           | Vendor ECDSA P-384 Signature of the Image Metadata Collection hashed using SHA2-384.<br />**X-Coordinate:** Public Key X-Coordinate (48 bytes)<br />**Y-Coordinate:** Public Key Y-Coordinate(48bytes)                                                                                                                                                                                                                                                                                                           |
| IMC Vendor LMS Signature | 1620         | Vendor LMOTS-SHA192-W4 signature of the Image Metadata Collection hashed using SHA2-384.<br />**q:** Leaf of the Merkle tree where the OTS public key appears (4 bytes)<br />**ots:** Lmots Signature (1252 bytes)<br />**tree_type:** Lms Algorithm Type (4 bytes)<br />**tree_path:** Path through the tree from the leaf associated with the LM-OTS signature to the root. (360 bytes)<br />Note: If LMS validation is not required, this field should be zeroed out.                             |
| IMC Owner ECC Signature  | 96           | Owner ECDSA P-384 Signature of the Image Metadata Collection hashed using SHA2-384.<br />**X-Coordinate:** Public Key X-Coordinate (48 bytes)<br />**Y-Coordinate:** Public Key Y-Coordinate(48bytes)                                                                                                                                                                                                                                                                                                            |
| IMC Owner LMS Signature  | 1620         | Owner LMOTS-SHA192-W4 signature of the Image Metadata Collection hashed using SHA2-384<br />**q:** Leaf of the Merkle tree where the OTS public key appears (4 bytes)<br />**ots:** Lmots Signature (1252 bytes)<br /> **tree_type:** Lms Algorithm Type (4 bytes)<br /> **tree_path:** Path through the tree from the leaf associated with the LM-OTS signature to the root. (360 bytes)<br /> Note: If LMS validation is not required, this field should be zeroed out.                            |

- ### **Image Metadata Entry**

| Field                   | Size (bytes) | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ----------------------- | ------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Image Hash              | 48           | SHA2-384 hash of a SOC image                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Image Identifier        | 4            | Unique value selected by the vendor to distinguish between component images.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Flags                   | 4            | A set of 32-bit flags specific to the image.<br />**Bit0**: If set, the image hash will not be verified otherwise the metadata image hash will be compared against the calculated hash of the image.<br />**Bit1**: If set, it indicates that the image is a MCU Runtime image, otherwise it indicates a SOC Image.                                                                                                                                                                                                                                                  |
| Image Load Address High | 4            | The higher 4 bytes of the 64-bit AXI address where the image will be loaded for verification and execution or staging.                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Image Load Address Low  | 4            | The lower 4 bytes of the 64-bit AXI address where the image will be loaded for verification and execution or staging                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Classification          | 4            | This field indicates the DMTF Firmware classification of the image.<br />Refer to the description of ComponentClassification in [DMTF PLDM Firmware Update Specification](https://www.dmtf.org/sites/default/files/standards/documents/DSP0267_1.3.0.pdf)                                                                                                                                                                                                                                                                                                                            |
| Version Number          | 4            | This is a vendor-defined field which can used to compare versions of the image.<br />This is useful when comparing the current version in the device with the one in this package by using<br />integer comparison rather than comparing using the VersionString.<br />For example, this can be in the form of MajorMinorRevisionPatch or a timestamp corresponding to the release date.<br />This functions the same as the ComponentComparisonStamp in [DMTF PLDM Firmware Update Specification](https://www.dmtf.org/sites/default/files/standards/documents/DSP0267_1.3.0.pdf) |
| Version String          | 32           | <br />A null-terminated utf-8 string that indicates the version of the image, the maximum length is limited<br />to 32 bytes including the string terminator.<br /><br />Example: "1.2.0"                                                                                                                                                                                                                                                                                                                                                                                          |
| ImageSize               | 4            | Size in bytes of the image.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

- ### **Image Metadata Collection**

The Image Metadata Collection (IMC) is a collection of Image Metadata entries (IME). Each IME has a hash that matches a SOC images. The manifest vendor and owner private keys sign the IMC. The Preamble holds the IMC signatures. The manifest IMC vendor signatures are optional and are validated only if the FLAGS field Bit 0 = 1. Up to 127 image hashes are supported.

| Field                            | Size (bytes) | Description                             |
| -------------------------------- | ------------ | --------------------------------------- |
| Image Metadata Entry (IME) Count | 4            | Number of IME(s) in the IMC             |
| Image Metadata Entry (N)         | Variable     | List of Image Metadata Entry structures |
